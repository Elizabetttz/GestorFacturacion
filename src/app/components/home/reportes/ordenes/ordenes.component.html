<h1 class="title">Cuadro De Órdenes de Compra</h1>

<div class="table-container">
    <div class="table-wrapper">
        <div class="toolbar">
            <div class="search-box">
                <input 
                    type="text" 
                    [(ngModel)]="searchTerm"
                    (input)="filterOrdenes()"
                    placeholder="Buscar por NIT, Comprador o Descripción..." 
                    class="search-input" 
                />
                <span class="search-icon"><i-feather name="search"></i-feather></span>
            </div>
            <button class="export-button" (click)="actualizarOrdenes()">
                <span class="icon"></span> Actualizar órdenes
            </button>
        </div>

          <div 
        class="modal-overlay" 
        *ngIf="cargando || procesoCompletado || error">
    </div>

<!-- Ventana modal -->
    <div class="modal-window" *ngIf="cargando || procesoCompletado || error">

        <!-- Cargando -->
        <div *ngIf="cargando" class="modal-content">
            <h2>Procesando...</h2>
                <p class="mt-2">Esto puede tardar unos segundos...</p>
                <div class="spinner">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                </div>
        </div>

        <!-- Completado -->
        <div *ngIf="procesoCompletado" class="modal-content">
            <h2>¡Proceso Completado!</h2>
            <p>{{ mensaje }}</p>
            <button class="close-btn" (click)="cerrarModal()">Cerrar</button>
        </div>

        <!-- Error -->
        <div *ngIf="error" class="modal-content error">
            <h2>Ocurrió un error</h2>
            <p>{{ mensaje }}</p>
            <button class="close-btn" (click)="cerrarModal()">Cerrar</button>
        </div>

    </div>


        <div class="table-scroll">
            <table class="modern-table">
                <thead>
                    <tr>
                        <th class="numeric">ID</th>
                        <th (click)="sortBy('comprador_nit')" class="sticky-col">
                            NIT Comprador <span class="sort-icon">⇅</span>
                        </th>
                        <th>Comprador</th>
                        <th (click)="sortBy('fecha_elaboracion')">Fecha Elaboración <span class="sort-icon">⇅</span></th>
                        <th>Descripción</th>
                        <th class="numeric">Cantidad</th>
                        <th class="numeric">Precio Unitario</th>
                        <th class="numeric">Valor Total Item</th>
                        <th class="numeric">Subtotal</th>
                        <th class="numeric">IVA</th>
                        <th class="numeric highlight">Total</th>
                        <th>Términos de Pago</th>
                        <th class="actions-col sticky-right">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let orden of paginatedOrdenes">
                        <td class="bold" data-label="ID">{{ orden.id }}</td>
                        <td data-label="NIT Comprador" class="sticky-col varchars">{{ orden.comprador_nit }}</td>
                        <td data-label="Comprador" class="tercero-cell">{{ orden.comprador_nombre }}</td>
                        <td data-label="Fecha Elaboración" class="varchars">{{ orden.fecha_elaboracion | date: 'dd/MM/yyyy' }}</td>
                        <td data-label="Descripción" class="concepto-cell">{{ orden.descripcion }}</td>
                        <td data-label="Cantidad" class="numeric">{{ orden.cantidad }}</td>
                        <td data-label="Precio Unitario" class="numeric">{{ orden.precio_unitario }}</td>
                        <td data-label="Valor Total Item" class="numeric">{{ orden.valor_total_item  }}</td>
                        <td data-label="Subtotal" class="numeric">{{ orden.subtotal  }}</td>
                        <td data-label="IVA" class="numeric">{{ orden.iva  }}</td>
                        <td data-label="Total" class="numeric highlight bold">{{ orden.total}}</td>
                        <td data-label="Términos de Pago" class="varchars">{{ orden.terminos_pago }}</td>
                        
                        <td data-label="Acciones" class="actions-col sticky-right">
                            <button class="action-btn view" title="Ver detalles" (click)="downloadPDF(orden.ruta)">
                                <i-feather name="eye"></i-feather>
                            </button>
                            
                            <button class="action-btn edit" title="Editar">
                                <i-feather name="edit"></i-feather>
                            </button>
                            <button class="action-btn delete" title="Eliminar" (click)="deleteOrden(orden)">
                                <i-feather name="trash-2"></i-feather>
                            </button>
                        </td>
                    </tr>
                    <tr *ngIf="filteredOrdenes.length === 0">
                        <td colspan="14" class="empty-state">
                            <div class="empty-message">
                                <span class="empty-icon"></span>
                                <p>No se encontraron órdenes de compra</p>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="table-footer">
            <div class="results-info">
                Mostrando {{ filteredOrdenes.length }} de {{ ordenes().length }} órdenes de compra
            </div>
            <div class="pagination-controls">
                <button class="page-btn" [disabled]="currentPage === 1" (click)="previousPage()">
                    ← Anterior
                </button>
                <span class="page-info">Página {{ currentPage }} de {{ totalPages }}</span>
                <button class="page-btn" [disabled]="currentPage === totalPages" (click)="nextPage()">
                    Siguiente →
                </button>
            </div>
        </div>
    </div>
</div>